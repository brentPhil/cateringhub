[ ] NAME:Current Task List DESCRIPTION:Root task for conversation __NEW_AGENT__
-[ ] NAME:Redesign CateringHub's Assignment Infrastructure DESCRIPTION:Migrate from individual-assignment model to location/team-based dispatch system for caterers operating with teams serving defined geographic areas
--[/] NAME:3. API & Backend Modifications DESCRIPTION:Update backend endpoints and server actions for team-based operations. Status: 4/7 tasks complete. Remaining: auto-assignment logic, concurrency checks, feature flag control.
---[ ] NAME:Auto-assignment logic DESCRIPTION:Develop logic to auto-assign booking's service location based on venue proximity (geolocation APIs) and pick appropriate team based on capacity/availability. Provide manual selection fallbacks
---[ ] NAME:Concurrency checks DESCRIPTION:When creating/updating bookings, enforce daily_capacity and max_concurrent_events per service location. Decide whether to hard block or warn managers on over-capacity
---[ ] NAME:Feature flag control DESCRIPTION:Integrate feature flag that toggles between individual and team-based assignment in API layer and client-visible logic for staged rollout
--[/] NAME:4. Client & Frontend Updates DESCRIPTION:Update UI components and state management for team-based workflows
---[/] NAME:Expose location/team information DESCRIPTION:Update data tables and details pages to display service location and team responsible for each booking. Provide quick indicators of capacity (e.g., '3/5 slots filled')
---[ ] NAME:Add team and location management UIs DESCRIPTION:Create pages/modals to manage service locations (including capacity fields) and teams (create team, assign members, set capacities). Tie to role-based permissions
---[ ] NAME:Update shift assignment UI DESCRIPTION:When adding shifts to booking, pre-filter selectable workers by booking's team membership. Optionally allow assigning entire team to shift if group assignment enabled
---[ ] NAME:Modify state management and query keys DESCRIPTION:Extend useBookings, useTeamMembers, and related hooks to accept service location and team filters. Ensure caching and pagination work with new parameters
---[ ] NAME:Handle dual-write mode DESCRIPTION:Under feature flag, maintain both old and new assignment fields in forms and API calls. Gradually hide individual assignment fields as migration progresses
--[ ] NAME:5. Data Migration Strategy DESCRIPTION:Plan and execute migration from individual to team-based assignments
---[ ] NAME:Add columns DESCRIPTION:In first migration, add service_location_id and team_id to bookings and team_id to provider_members. Ensure columns are nullable and don't break existing code
---[ ] NAME:Populate initial service locations DESCRIPTION:For each provider, review existing service_locations and ensure at least one exists (create if necessary). Populate daily_capacity and max_concurrent_events with defaults based on current global daily_capacity
---[ ] NAME:Create initial teams DESCRIPTION:For each service location, create corresponding team (e.g., 'Metro Manila Team') and assign to location. Use clear naming conventions including location names
---[ ] NAME:Map members to teams DESCRIPTION:Assign each existing staff member (provider_member) to team based on service location they primarily serve. Document ambiguous assignments for manual resolution
---[ ] NAME:Backfill bookings DESCRIPTION:For existing bookings, infer service_location_id from current assigned_to user's primary team or booking's venue address. Infer team_id from service_location_id. Log mappings for audit
---[ ] NAME:Dual-write period DESCRIPTION:Update booking creation and assignment flows to write both assigned_to and new service_location_id/team_id fields. Continue to honour existing RLS policies during this period
---[ ] NAME:Cutover DESCRIPTION:After verifying all bookings and team assignments are correct and client updated, enable team-based RLS policies and disable individual assignment policies. Stop writing to assigned_to but retain column for historical queries
---[ ] NAME:Cleanup DESCRIPTION:In later migration, remove or archive assigned_to and drop associated indexes (idx_bookings_assigned_to, idx_bookings_assigned_status) once all dependencies removed. Remove deprecated client filters
--[ ] NAME:6. Testing & Rollout DESCRIPTION:Test and deploy changes in staged rollout with monitoring
---[ ] NAME:Unit and integration tests DESCRIPTION:Create tests for new database functions, RLS policies, and API endpoints. Ensure staff only see bookings belonging to their team(s) and capacity rules are enforced
---[ ] NAME:Performance testing DESCRIPTION:Benchmark queries that fetch bookings by service location and team to ensure they meet performance targets (P95 ≤100ms). Adjust indexes or query patterns if needed
---[ ] NAME:Staging rollout DESCRIPTION:Deploy changes to staging environment under feature flag. Run backfill scripts and verify correctness of data and user experiences
---[ ] NAME:User acceptance testing (UAT) DESCRIPTION:Involve pilot group of providers and staff to test new team-based workflow. Gather feedback on UI/UX and adjust accordingly
---[ ] NAME:Phased production rollout DESCRIPTION:Enable feature flag for subset of providers, monitor system behaviour, and incrementally enable for all providers. Provide real-time monitoring and error alerts during rollout
--[ ] NAME:7. Governance, Documentation & Training DESCRIPTION:Create documentation, SOPs, and training materials for new system
---[ ] NAME:Documentation DESCRIPTION:Produce comprehensive developer documentation describing new tables, functions, RLS policies, and migration scripts. Update API and client documentation to reflect new fields and parameters
---[ ] NAME:Operational guidelines DESCRIPTION:Write internal SOPs for providers on how to set up service locations, create teams, configure capacity, and assign bookings. Clarify responsibilities (e.g., who can override capacity limits)
---[ ] NAME:Training materials DESCRIPTION:Create training sessions and quick-start guides for staff and managers explaining new team-based workflow and concurrent event handling. Highlight differences from previous individual assignment model and emphasize location-based operations
---[ ] NAME:Audit & compliance DESCRIPTION:Ensure new assignment changes are logged and retained in booking_audits. Review data retention policies to accommodate potential increases in audit log size
---[ ] NAME:Open questions resolution DESCRIPTION:Conduct product discovery sessions to answer open questions (e.g., auto-assign vs. manual, multi-team bookings, cross-team membership, capacity enforcement strategy). Document decisions and incorporate into design
--[ ] NAME:8. Future Enhancements DESCRIPTION:Plan advanced features like hierarchical locations and multi-team assignments
---[ ] NAME:Hierarchical locations DESCRIPTION:Extend service_locations model to support nested regions (province → city → barangay) and dynamic routing based on distance and service radius
---[ ] NAME:Multi-team assignments DESCRIPTION:Investigate support for assigning multiple teams to single booking (e.g., very large events). Would require junction table (booking_team_assignments) and RLS adjustments
---[ ] NAME:Dynamic staffing & availability DESCRIPTION:Integrate staff availability calendars to auto-select team members for shifts and prevent overbooking individuals
---[ ] NAME:Real-time capacity dashboards DESCRIPTION:Build dashboards to visualise capacity utilisation across all locations and teams, enabling managers to plan resources effectively
---[ ] NAME:Analytics enhancements DESCRIPTION:Enhance analytics to report revenue, workload, and performance metrics per location and per team, helping providers make data-driven decisions
---[ ] NAME:Integration with mapping APIs DESCRIPTION:Use mapping services to calculate travel times and distances between kitchens and event venues, improving auto-assignment accuracy
-[ ] NAME:Current Task List DESCRIPTION:Root task for conversation __NEW_AGENT__
--[ ] NAME:Current Task List DESCRIPTION:Root task for conversation __NEW_AGENT__
-[ ] NAME:Create edit team drawer DESCRIPTION:Create teams/components/edit-team-drawer.tsx with form validation
-[ ] NAME:Add teams navigation item DESCRIPTION:Add Teams navigation item to app-sidebar.tsx
-[ ] NAME:Add team selection to booking creation DESCRIPTION:Update create-manual-booking-drawer to include team selection field
-[ ] NAME:Update booking assignment logic DESCRIPTION:Modify booking creation/update to support team-based assignment alongside individual assignment
-[ ] NAME:Test booking-team integration DESCRIPTION:Verify all booking-team functionality works correctly
-[ ] NAME:Current Task List DESCRIPTION:Root task for conversation __NEW_AGENT__